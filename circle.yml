machine:
  services:
    - docker

dependencies:
  override:
    - gem uninstall puppet -a
    - bundle install --without development:
        environment:
          PUPPET_GEM_VERSION: '~> 3.0'

test:
  override:
    - bundle exec rake lint
    - bundle exec rake validate
    - bundle exec rake spec SPEC_OPTS="--format RspecJunitFormatter -o $CIRCLE_TEST_REPORTS/rspec/puppet3.xml":
        environment:
          PUPPET_GEM_VERSION: '~> 3.0'
    - bundle update puppet:
        environment:
          PUPPET_GEM_VERSION: '~> 4.0'
          STRICT_VARIABLES: 'yes'
    - bundle exec rake spec SPEC_OPTS="--format RspecJunitFormatter -o $CIRCLE_TEST_REPORTS/rspec/puppet3.xml":
        environment:
          PUPPET_GEM_VERSION: '~> 4.0'
          STRICT_VARIABLES: 'yes'
#    - BEAKER_set=centos6 bundle exec rake beaker:
#        timeout: 200
#    - BEAKER_set=centos7 bundle exec rake beaker:
#        timeout: 200
#    - BEAKER_set=ubuntu12.04 bundle exec rake beaker:
#        timeout: 200
#    - BEAKER_set=ubuntu14.04 bundle exec rake beaker:
#        timeout: 200
#    - BEAKER_set=debian7 bundle exec rake beaker:
#        timeout: 200

general:
  branches:
    only:
      - circleci
      - /v[0-9]+(\.[0-9]+)*/

notify:
  webhooks:
    # A list of hook hashes, containing the url field
    # gitter hook
    - url: https://webhooks.gitter.im/e/da8c065419a91983f0cf
